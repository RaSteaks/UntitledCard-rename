# 存储卡重命名工具

macOS 专用工具，自动识别存储卡中的视频素材文件，提取卷号并重命名存储卡。

## 功能特性

- 自动扫描存储卡中的视频素材文件（自动过滤隐藏文件）
- 支持多种视频格式：MXF, MOV, MP4, R3D, ARI, BRAW
- **智能卷号识别**：
  - 优先从摄影机元数据文件提取卷号
  - 支持 Sony XDCAM、Canon、Panasonic、RED 等主流摄影机元数据
  - 备用：从文件名提取卷号（如 `A001C001_200101B6.MXF` → `A001`）
- 卷号历史记录管理与重复检测警告
- 可视化历史表格（按字母排序，同字母按数字升序）
- 工作流程步骤指示器（刷新 → 分析 → 重命名 → 推出）
- 可拖动调整的面板布局
- 安全推出存储卡

## 支持的摄影机元数据格式

| 摄影机品牌 | 元数据文件 | 路径示例 |
|----------|------------|--------|
| Sony XDCAM | MEDIAPRO.XML, DISCMETA.XML | 根目录 |
| Canon | CLIPINFO.XML | CANON/*/CLIPINFO.XML |
| Panasonic | CLIPINFO.XML | CONTENTS/CLIP/*/CLIPINFO.XML |
| RED | .RDC, .RMD | 根目录 |

程序会自动识别存储卡结构，优先从元数据文件中提取卷号。

## 支持的文件命名格式

| 格式示例 | 提取的卷号 | 说明 |
|---------|-----------|------|
| A001C001_200101B6.MXF | A001 | Sony XDCAM |
| B002C015_240115AB.mov | B002 | ARRI |
| C003R001_123456.MP4 | C003 | 通用格式 |

命名规则：文件名以 **1个大写字母 + 3个数字** 开头（如 A001, B002, C003）

## 使用方法

### 方式一：运行 Python 脚本

```bash
python3 rename_card.py
```

### 方式二：运行打包后的应用程序

双击 `存储卡重命名工具.app`

## 操作流程

1. 插入存储卡
2. 启动程序
3. 点击 **刷新列表** 获取最新存储卡列表
4. 从下拉框选择存储卡（默认优先选择 "Untitled"）
5. 点击 **分析存储卡** 按钮
6. 查看检测结果：
   - 视频文件数量
   - 检测到的卷号
   - 重复警告（如卷号已存在于历史记录）
7. 从卷号下拉框选择目标名称
8. 点击 **重命名存储卡** 执行重命名
9. 点击 **推出存储卡** 安全弹出

## 界面说明

- **步骤指示器**：顶部显示当前工作流程进度（○待处理 / ◉进行中 / ●已完成）
- **卷号历史表格**：按字母分列显示所有历史卷号，支持滚动查看
- **工作日志**：显示操作详情，支持滚动查看
- **可调整布局**：拖动历史表格与日志之间的分隔条调整高度

## 构建可执行文件

### 前提条件

```bash
pip install pyinstaller
```

### macOS 构建

```bash
pyinstaller --onefile --windowed --name "存储卡重命名工具" rename_card.py
```

生成的应用位于 `dist/存储卡重命名工具.app`

## 系统要求

- **macOS**: macOS 10.14 或更高版本
- **Python**: 3.7 或更高版本（仅源码运行需要）

## 配置文件

程序使用两个配置文件：

1. **用户设置文件**（固定位置）：`~/.card_renamer_settings.json`
   - 存储用户自定义的配置文件路径

2. **数据配置文件**（可自定义位置）：默认 `~/.card_renamer_config.json`
   - 存储上次使用的卷号
   - 存储卷号历史记录
   - 可通过「设置路径」按钮更改保存位置

## 注意事项

- 确保存储卡未被其他程序占用
- 重命名后存储卡会保持挂载状态
- 重复卷号会显示警告，但仍可选择继续操作

## 许可证

MIT License
